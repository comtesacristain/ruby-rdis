<h1>Editing Duplicate Group</h1>

<%= form_for(@duplicate) do |f| %>
  <% if @duplicate.errors.any? %>
    <div id="error_explanation">
      <h2><%= pluralize(@duplicate.errors.count, "error") %> prohibited this duplicate from being saved:</h2>

      <ul>
      <% @duplicate.errors.full_messages.each do |message| %>
        <li><%= message %></li>
      <% end %>
      </ul>
    </div>
  <% end %>


<table class='duplicates'>
	<tr>
	  <th>Primary Key</th>
	  <th>Name</th>
	  <th>Entity Type</th>
	  <th>Longitude (x)</th>
	  <th>Latitude (y)</th>
	  <th>Height (z)</th>
	  <th>Auto Remediation</th>
	  <th>Auto Transfer</th>
	  
	  <th>OR remediation</th>
	  <th>OR transfer</th>
	   <th>OR comment</th>
	   <th>Manual remediation</th>
	   <th>Manual transfer</th>
	 
	  </tr>
  

  
    <% @duplicate.boreholes.each do |borehole| %>
    <% row_class = get_row_class(borehole.handler.auto_remediation) %>
    <tr class='<%= row_class%>'>
  	  <td><%=borehole.eno%></td>
  	  <td><%=borehole.entityid%></td>
  	  <td><%=borehole.entity_type%></td>
  	   <td><%=borehole.x%></td>
  	    <td><%=borehole.y%></td>
  		 <td><%=borehole.z%></td>
	

  	  <td><%=borehole.handler.auto_remediation%></td>
  	  <td><%=borehole.handler.auto_transfer%></td>
  	  <td><%=borehole.handler.or_status%></td>
  	  <td><%=borehole.handler.or_transfer%></td>
  	  <td><%=borehole.handler.or_comment%></td>

	  <%= f.fields_for :handlers, borehole.handler do |field| %>
  	  	<td><%=field.select :manual_remediation, options_for_select([nil,"KEEP","DELETE","NONE"],borehole.handler.manual_remediation)%></td>
  	  	<td><%=field.select :manual_transfer, options_for_select([nil,@duplicate.boreholes.where.not(:eno=>borehole.eno).pluck(:eno)].flatten,borehole.handler.manual_transfer) %></td>
	  <% end %>
    </tr>
  <% end %>
</table>

<div>
	<div>
		<%= f.label :comments, "Comments:" %>
	</div>
	<div>
		<%= f.text_area :comments, rows: 5, cols: 50%>
	</div>
</div>
  <table><tr>
	<td><%= f.label :auto_approved, "Approve Automatic Remediation?" %></td>
	<td><%= f.select :auto_approved, options_for_select({nil=>nil,"Yes"=>"Y","No"=>"N"})%></td>
  </tr></table>
  <div class="actions">
    <%= f.submit %>
  </div>
<% end %>



<% content_for(:head) do %>
  <%= stylesheet_link_tag    'duplicates', media: 'all', 'data-turbolinks-track' => true %>
  <% end %>

<%= link_to 'Show', @duplicate %> |
<%= link_to 'Back', duplicates_path %>
